<!--
<style>
  #pictureInPicture_iframe{
    position: fixed;
    bottom: 0;
    right: 0;
    margin: 5px;
    padding: 5px;
    background-color: #cfcfcf;
    border-radius: 15px; 
  }
</style>
<script>
  let pictureInPicture_checkbox_div = document.createElement('div')
  pictureInPicture_checkbox_div.id = 'pictureInPicture_div';
  pictureInPicture_checkbox_div.innerHTML = '<label for="pictureInPicture_checkbox"><input id="pictureInPicture_checkbox" type="checkbox"></label>'
  document.getElementById('ajaxSend_checkbox_div').after(pictureInPicture_checkbox_div)
  
  let pictureInPicture_checkbox = document.getElementById('pictureInPicture_checkbox');
  let pictureInPicture_div = document.createElement('div')
  pictureInPicture_div.id = 'pictureInPicture_display';
  pictureInPicture_div.innerHTML = '<iframe id="pictureInPicture_iframe" class="hiddenElm"></iframe>'
  document.getElementById('shortcut_help').after(pictureInPicture_div)
  
  function urlConvertToLink(str){
    const pattern = /(?:h?ttps?:\/\/[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+|\/(?:watch|search|playlist)\?(?:[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+=[\w%]+&?)+|\/(?:channel|hashtag)\/[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+)/g
    /* これを纏めた
      /((h?)(ttps?:\/\/[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+))/g
      /\/(?:watch|search|playlist)\?(?:[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+=[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+&?)+/g
      /\/(?:channel|hashtag)\/[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+/g
    */
    if(pictureInPicture_checkbox.checked){
      var makeLink = function(matched) {
        return `<a href="${matched}">${matched}</a>`;
      }
    }else{
      var makeLink = function(matched) {
        return `<a href="${matched}">${matched}</a>`;
      }
    }
    return '<h2 class="red">【お知らせ】機能追加のため一時的にBBSが使用できなくなる場合があります。御了承下さい。</h2>' + str.replace(pattern, makeLink)
  }
</script>
-->

<style>
  #pictureInPicture_iframe {
    position: fixed;
    bottom: 0;
    right: 0;
    margin: 5px;
    padding: 5px;
    background-color: #dfdfdf;
    border-radius: 15px;
  }
</style>
<script>
  // もし（Ajax使用中かつ）PIPを使う（.checked）なら
  let pictureInPicture_checkbox_div = document.createElement('div');
  pictureInPicture_checkbox_div.id = 'pictureInPicture_div';
  pictureInPicture_checkbox_div.innerHTML = '<label for="pictureInPicture_checkbox">ピクチャインピクチャを利用(Ajax使用時のみ利用可能)<input id="pictureInPicture_checkbox" type="checkbox" onchange="changePictureInPictureCheckbox(this)"></label>';
  document.getElementById('ajaxSend_checkbox_div').after(pictureInPicture_checkbox_div)
  
  let pictureInPicture_checkbox = document.getElementById('pictureInPicture_checkbox');
  
  let ajaxSend_checkbox = document.getElementById('ajaxSend_checkbox');

  let pictureInPicture_div = document.createElement('div')
  pictureInPicture_div.id = 'pictureInPicture_display';
  pictureInPicture_div.innerHTML = '<iframe id="pictureInPicture_iframe" class="hiddenElm"></iframe>'
  document.getElementById('shortcut_help').after(pictureInPicture_div)

  
  function changePictureInPictureCheckbox(elem){
    let pictureInPicture_iframe = document.getElementById('pictureInPicture_iframe');
    
    if(elem.checked){
      if(!document.getElementById('ajaxSend_checkbox').checked){
        elem.checked = false;
        pictureInPicture_iframe.setAttribute('class', 'hiddenElm');
        pictureInPicture_iframe.setAttribute('allow', 'none');
      }else{
        pictureInPicture_iframe.removeAttribute('class');
        pictureInPicture_iframe.setAttribute('allow', 'autoplay; \'src\'');
      }
    }else{
      pictureInPicture_iframe.setAttribute('class', 'hiddenElm');
      pictureInPicture_iframe.setAttribute('allow', '\'none\'');
    }
  }
  
  function setSrcToPictureInPicture(src_content){
    document.getElementById('pictureInPicture_iframe').setAttribute('src', src_content);
  }
  /*
  function urlConvertToLink(str){
    const pattern = /(?:h?ttps?:\/\/[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+|\/(?:watch|search|playlist)\?(?:[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+=[\w%]+&?)+|\/(?:channel|hashtag)\/[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+)/g
    
    //
    ///((h?)(ttps?:\/\/[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+))/g
    //  /\/(?:watch|search|playlist)\?(?:[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+=[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+&?)+/g
    //  /\/(?:channel|hashtag)\/[\w\.\-_@:\/~\?%&;=\+#',\(\)\*\!]+/g
    
    
    if(document.getElementById('pictureInPicture_checkbox').checked){
      var makeLink = function(matched) {
        return `<a href="javascript:setSrcToPictureInPicture('${matched}')">${matched}</a>`;
      }
    }else{
      var makeLink = function(matched) {
        return `<a href="${matched}">${matched}</a>`;
      }
    }
    return str.replace(pattern, makeLink)
  }
 */
</script>
